@{
    System.Web.UI.WebControls.DropDownList ddl = new System.Web.UI.WebControls.DropDownList();
    


    //Page.Title = "Add Question";
    int test = 1;
    var Question = "";
    var Tags = "";
    var Answer = "";
    var course="";
    var nr = 0;
    
    bool correct=true;
    var selectcommand = "SELECT * FROM T_Lecture WHERE course_id = @0";
    var addcommand = "INSERT INTO T_Question (question, tags) Values (@0, @1)";
    var addrelation = "INSERT INTO T_Question_Lecture (question_id, lecture_id) Values (@0, @1)";
    var addanswer = "INSERT INTO T_Answer (question_id, answer, correct) Values (@0, @1, @2)";

    var db = Database.Open("102547-concepttest");
    var selected = db.Query("SELECT * FROM T_Course");
    
    if(IsPost && !Request["Submit"].IsEmpty())
    {
        Validation.RequireField("Question", "You must submit a question");
        Validation.RequireField("Tags", "Tags required");
        var lectureId = Request.Form["lectures"];

        if(Validation.IsValid()){
            Question = Request.Form["Question"];
            Tags = Request.Form["Tags"];
            
            
            
                db.Execute("START TRANSACTION");
                    db.Execute(addcommand, Question, Tags);
                    var id = db.GetLastInsertId();
                    db.Execute(addrelation, id, lectureId);
                    //Variabeln för antal svar måste fixas
                    for(int k = 1; k <= 10; k++){
                        Answer = Request.Form[k.ToString()];
                        if(Answer != null && Answer != ""){
                            db.Execute(addanswer, id, Answer, correct);
                        }
                    }
                db.Execute("COMMIT");
        }
    }  
}

<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="StyleSheet.css">

                <script type="text/javascript">
                    var i = 0;

                    function addform() {

                        var parentdiv = document.getElementById("mydiv");
                        var br = document.createElement();
                        br.innerHTML = "<br/>";

                        i++;
                        var text = document.createElement();
                        text.innerHTML = "Answer " + (i) + ": ";
                        var input = document.createElement("input");
                        input.setAttribute("type", "text");
                        input.setAttribute("name", i);
                        input.setAttribute("value", "");

                        parentdiv.appendChild(text);
                        parentdiv.appendChild(input);
                        parentdiv.appendChild(br);

                    }
                </script>

        <title>Add Question</title>
    </head>
    <body>
        <form method="post">

            <div id="mydiv">

                <h1>Add question</h1>

                <hr>
                @Answer


                <select id="categoryId" name="categoryId">
                    <option value="">-- Select course --</option>

                    @foreach(var category in selected){
                            <option value="@category.id">@category.course_name</option>
                    }
                </select>
            
                @{
                    course = Request.Form["categoryId"];
                    var selectedlectures = db.Query(selectcommand, course); 
                }

                <select id="lectures" name="lectures">
                    <option value="">-- Select lecture --</option>
                    @foreach(var matchinglectures in selectedlectures){
                        <option value="@matchinglectures.id">@matchinglectures.date</option>
                    }
                </select>

                <br/>
                Question:
                <input type="text" name="Question" value="" style="margin-left: 26px" />
                @Html.ValidationMessage("Question")
                <br/>
                Tags:
                <input type="text" name="Tags" value="" style="margin-left: 50px" />
                @Html.ValidationMessage("Tags")
                <br/>
                <br/>
                <input type="button" name="addanswer" value="+" onclick="addform()" />
                Add Answer
                <br/>


                
                <input type="Submit" name="Submit" value="Submit" />                
                
                <p><a href="dashboard.cshtml">Back to dashboard</a></p>

            </div>

        </form>
    </body>
</html>
