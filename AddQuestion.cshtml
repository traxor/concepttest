@{
    System.Web.UI.WebControls.DropDownList ddl = new System.Web.UI.WebControls.DropDownList();
    


    //Page.Title = "Add Question";
    int test = 1;
    var Question = "";
    var Tags = "";
    var Answer = "";
    var course="";
    var nr = 0;
    
    
    var selectcommand = "SELECT * FROM T_Lecture WHERE course_id = @0";
    var addcommand = "INSERT INTO T_Question (question, tags) Values (@0, @1)";
    var addrelation = "INSERT INTO T_Question_Lecture (question_id, lecture_id) Values (@0, @1)";
    var addanswer = "INSERT INTO T_Answer (question_id, answer, correct) Values (@0, @1, @2)";

    var db = Database.Open("102547-concepttest");
    var selected = db.Query("SELECT * FROM T_Course");
    
    if(IsPost && !Request["Submit"].IsEmpty())
    {
        Validation.RequireField("Question", "You must submit a question");
        Validation.RequireField("Tags", "Tags required");
        var lectureId = Request.Form["lectures"];

        if(Validation.IsValid()){
            Question = Request.Form["Question"];
            Tags = Request.Form["Tags"];
            
                db.Execute("START TRANSACTION");
                    db.Execute(addcommand, Question, Tags);
                    var id = db.GetLastInsertId();
                    db.Execute(addrelation, id, lectureId);
                    //Variabeln för antal svar måste fixas
                    for(int k = 1; k <= 10; k++){
                        Answer = Request.Form[k.ToString()];
                        var correct = Request.Form[(k+10).ToString()];
                        if(Answer != null && Answer != ""){
                            if(correct == "correct"){
                                db.Execute(addanswer, id, Answer, 1);
                            }else{
                                db.Execute(addanswer, id, Answer, 0);
                            }
                        }
                    }
                db.Execute("COMMIT");
        }
    }  
}

<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="StyleSheet.css">

                <script type="text/javascript">
                    var i = 0;
                    var j = 10;

                    function addform() {

                        var parentdiv = document.getElementById("answerfield");

                        i++;
                        j++;

                        var text = document.createElement();
                        text.innerHTML = "Answer " + (i) + ": ";

                        var correcttext = document.createElement();
                        correcttext.innerHTML = "Correct: ";

                        var newrow = document.createElement();
                        newrow.innerHTML = "<br/>";

                        var Answer = document.createElement("input");
                        Answer.setAttribute("type", "text");
                        Answer.setAttribute("name", i);
                        Answer.setAttribute("value", "");

                        var checkbox = document.createElement("input");
                        checkbox.type = "Checkbox";
                        checkbox.name = j;
                        checkbox.value = "correct";
                        
                        parentdiv.appendChild(text);
                        parentdiv.appendChild(Answer);
                        parentdiv.appendChild(correcttext);
                        parentdiv.appendChild(checkbox);
                        parentdiv.appendChild(newrow);

                    }

                    function updatelectures() {

                        var lectures = document.getElementById("lectures");
                        document.forms["Submit"].submit();
                    }
                </script>

        <title>Add Question</title>
    </head>
    <body>
        <form method="post" id="Submit">

            <div id="mydiv">

                <h1>Add question</h1>

                <hr>
                <br/>

                <select id="categoryId" name="categoryId" onchange="updatelectures()">
                    <option value="">-- Select course --</option>

                    @foreach(var category in selected){
                            if(Request.Form["categoryId"] == category.id.ToString()){
                                <option value="@category.id" selected>@category.course_name</option>
                            }else{
                                <option value="@category.id">@category.course_name</option>
                            }
                    }
                </select>
            
                @{
                    course = Request.Form["categoryId"];
                    var selectedlectures = db.Query(selectcommand, course); 
                }

                <select id="lectures" name="lectures">
                    <option value="">-- Select lecture --</option>
                    @foreach(var matchinglectures in selectedlectures){
                        <option value="@matchinglectures.id">@matchinglectures.date</option>
                    }
                </select>

                <br/>
                Question:
                <input type="text" name="Question" value="" style="margin-left: 26px" />
                @Html.ValidationMessage("Question")
                <br/>
                Tags:
                <input type="text" name="Tags" value="" style="margin-left: 50px" />
                @Html.ValidationMessage("Tags")
                <br/>
                <br/>
                <input type="button" name="addanswer" value="+" onclick="addform()" />
                Add Answer
                <br/>

                <p id="answerfield"></p>
                
                <input type="Submit" name="Submit" value="Submit" />                
                
                <p><a href="dashboard.cshtml">Back to dashboard</a></p>
            </div>
        </form>
    </body>
</html>
